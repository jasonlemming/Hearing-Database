{% extends "brookings_base.html" %}

{% block title %}Browse Policy Library{% endblock %}

{% block head_style %}
.filter-grid {
    display: grid;
    grid-template-columns: 2fr 2fr 1.5fr 1.5fr auto;
    gap: 1rem;
    margin-bottom: 3rem;
    align-items: end;
}

.filter-grid label {
    display: block;
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
}

.document-list {
    display: flex;
    flex-direction: column;
    gap: 0;
}

.document-link {
    display: block;
    text-decoration: none;
    color: #1a1a1a;
    padding: 2rem 0;
    border-bottom: 1px solid #f0f0f0;
    transition: all 0.3s ease;
}

.document-link:hover {
    transform: translateX(5px);
    color: #0d6efd;
}

.document-link:hover .document-title {
    color: #0d6efd;
}

.document-title {
    font-size: 1.1rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
    transition: color 0.3s ease;
}

.document-meta {
    font-size: 0.9rem;
    color: #6c757d;
    margin-bottom: 0.5rem;
}

.document-summary {
    font-size: 0.95rem;
    color: #6c757d;
    line-height: 1.6;
}

.pagination {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 4rem;
    align-items: center;
}

.pagination a,
.pagination span {
    color: #6c757d;
    text-decoration: none;
    font-size: 0.9rem;
}

.pagination a:hover {
    color: #0d6efd;
    text-decoration: none;
}

.pagination .active {
    color: #1a1a1a;
    font-weight: 500;
}

.stats-line {
    font-size: 0.9rem;
    color: #6c757d;
    margin-bottom: 0.5rem;
}

.export-link {
    font-size: 0.85rem;
    color: #6c757d;
    float: right;
}

@media (max-width: 768px) {
    .filter-grid {
        grid-template-columns: 1fr;
    }

    .document-link:hover {
        transform: none;
    }
}
{% endblock %}

{% block content %}
<h1>Policy Library</h1>
<p class="text-secondary mb-4">{{ total|number_format }} documents from the Brookings Institution</p>

<!-- Filters -->
<form method="GET" action="{{ url_for('brookings.index') }}">
    <div class="filter-grid">
        <div>
            <label>Document Type</label>
            <select name="document_type">
                <option value="">All Types</option>
                {% for dt in document_types %}
                <option value="{{ dt }}" {% if dt == selected_document_type %}selected{% endif %}>{{ dt }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label>Subject</label>
            <select name="subject">
                <option value="">All Subjects</option>
                {% for subj in subjects[:50] %}
                <option value="{{ subj }}" {% if subj == selected_subject %}selected{% endif %}>{{ subj }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label>From Date</label>
            <input type="date" name="date_from" value="{{ date_from }}">
        </div>
        <div>
            <label>To Date</label>
            <input type="date" name="date_to" value="{{ date_to }}">
        </div>
        <div>
            <button type="submit">Apply</button>
        </div>
    </div>
</form>

<!-- Results header -->
{% if documents %}
<div class="mb-2">
    <span class="stats-line">{{ total }} results</span>
    <a href="{{ url_for('brookings.export_csv', **request.args) }}" class="export-link">Export CSV</a>
    <div style="clear: both;"></div>
</div>
{% endif %}

<!-- Document List -->
{% if documents %}
<div class="document-list">
    {% for doc in documents %}
    <a href="{{ url_for('brookings.document_detail', document_id=doc.document_id) }}" class="document-link">
        <div class="document-title">{{ doc.title }}</div>
        <div class="document-meta">
            Brookings Institution
            · {{ doc.publication_date or 'No date' }}
            {% if doc.document_type %} · {{ doc.document_type }}{% endif %}
            · {{ doc.word_count|number_format or 0 }} words
            {% if doc.pdf_url %} · PDF available{% endif %}
        </div>
        {% if doc.summary %}
        <div class="document-summary">{{ doc.summary[:200] }}{% if doc.summary|length > 200 %}...{% endif %}</div>
        {% endif %}
    </a>
    {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<nav class="pagination">
    {% if page > 1 %}
    <a href="{{ url_for('brookings.index', page=page-1, **request.args) }}">← Previous</a>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
    {% if p == page %}
    <span class="active">{{ p }}</span>
    {% elif p <= 3 or p >= total_pages - 2 or (p >= page - 2 and p <= page + 2) %}
    <a href="{{ url_for('brookings.index', page=p, **request.args) }}">{{ p }}</a>
    {% elif p == 4 or p == total_pages - 3 %}
    <span>...</span>
    {% endif %}
    {% endfor %}

    {% if page < total_pages %}
    <a href="{{ url_for('brookings.index', page=page+1, **request.args) }}">Next →</a>
    {% endif %}
</nav>
{% endif %}

{% else %}
<p class="text-secondary mt-4">No documents found matching your filters.</p>
{% endif %}
{% endblock %}
