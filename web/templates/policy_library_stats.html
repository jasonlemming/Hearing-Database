{% extends "policy_library_base.html" %}

{% block title %}Statistics - Policy Library{% endblock %}

{% block head_style %}
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 3rem;
    margin-bottom: 6rem;
}

.stat-block {
    text-align: center;
}

.stat-number {
    font-size: 3rem;
    font-weight: 500;
    color: #1a1a1a;
    line-height: 1;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.95rem;
    color: #6c757d;
}

.section {
    margin-bottom: 6rem;
}

.section-title {
    font-size: 1.25rem;
    font-weight: 500;
    margin-bottom: 2rem;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table td,
.data-table th {
    padding: 0.75rem 0;
    text-align: left;
    border-bottom: 1px solid #f0f0f0;
}

.data-table th {
    font-weight: 500;
    color: #1a1a1a;
    font-size: 0.9rem;
}

.data-table td {
    color: #6c757d;
    font-size: 0.95rem;
}

.data-table td:last-child,
.data-table th:last-child {
    text-align: right;
}

.data-table a {
    color: #0d6efd;
    text-decoration: none;
}

.data-table a:hover {
    text-decoration: underline;
}

.recent-list {
    display: flex;
    flex-direction: column;
    gap: 0;
}

.recent-link {
    display: block;
    text-decoration: none;
    color: #1a1a1a;
    padding: 1.5rem 0;
    border-bottom: 1px solid #f0f0f0;
    transition: all 0.3s ease;
}

.recent-link:hover {
    color: #0d6efd;
    transform: translateX(5px);
}

.recent-title {
    font-size: 1rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.recent-meta {
    font-size: 0.85rem;
    color: #6c757d;
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }

    .stat-number {
        font-size: 2rem;
    }

    .recent-link:hover {
        transform: none;
    }
}
{% endblock %}

{% block content %}
<h1>Statistics</h1>
<p class="text-secondary mb-6">Overview of policy research across all sources</p>

<!-- Summary Stats -->
<div class="stats-grid">
    <div class="stat-block">
        <div class="stat-number">{{ total_docs|number_format }}</div>
        <div class="stat-label">Total Documents</div>
    </div>
    <div class="stat-block">
        <div class="stat-number">{{ total_words|number_format }}</div>
        <div class="stat-label">Total Words</div>
    </div>
    <div class="stat-block">
        <div class="stat-number">{{ with_pdfs|number_format }}</div>
        <div class="stat-label">With PDFs</div>
    </div>
    <div class="stat-block">
        <div class="stat-number">{{ ((total_words / total_docs)|int)|number_format if total_docs > 0 else 0 }}</div>
        <div class="stat-label">Avg Words/Doc</div>
    </div>
</div>

<!-- Documents by Type -->
{% if by_type %}
<div class="section">
    <h2 class="section-title">Documents by Type</h2>
    <table class="data-table">
        <thead>
            <tr>
                <th>Type</th>
                <th>Count</th>
                <th>Percentage</th>
            </tr>
        </thead>
        <tbody>
            {% for doc_type, count in by_type %}
            <tr>
                <td>{{ doc_type or 'Unspecified' }}</td>
                <td>{{ count|number_format }}</td>
                <td>{{ ((count / total_docs * 100)|round(1)) }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Top Subjects -->
{% if top_subjects %}
<div class="section">
    <h2 class="section-title">Top 20 Subjects</h2>
    <table class="data-table">
        <thead>
            <tr>
                <th>Subject</th>
                <th>Documents</th>
            </tr>
        </thead>
        <tbody>
            {% for subject, count in top_subjects %}
            <tr>
                <td><a href="{{ url_for('policy_library.index', subject=subject) }}">{{ subject }}</a></td>
                <td>{{ count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Recent Documents -->
{% if recent %}
<div class="section">
    <h2 class="section-title">Recently Added Documents</h2>
    <div class="recent-list">
        {% for doc in recent %}
        <a href="{{ url_for('policy_library.document_detail', document_id=doc.document_id) }}" class="recent-link">
            <div class="recent-title">{{ doc.title[:100] }}{% if doc.title|length > 100 %}...{% endif %}</div>
            <div class="recent-meta">
                {{ doc.source.name if doc.source else 'Unknown' }}
                · {{ doc.publication_date }}
                {% if doc.document_type %} · {{ doc.document_type }}{% endif %}
                · {{ doc.word_count|number_format }} words
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
